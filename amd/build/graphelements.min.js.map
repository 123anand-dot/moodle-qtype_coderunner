{"version":3,"sources":["../src/graphelements.js"],"names":["define","util","Node","parent","x","y","mouseOffsetX","mouseOffsetY","isAcceptState","textBox","TextBox","caretPosition","prototype","setMouseStart","mouseX","mouseY","setAnchorPoint","trackMouse","draw","c","beginPath","arc","nodeRadius","Math","PI","stroke","closestPointOnCircle","dx","dy","scale","sqrt","containsPoint","neighbours","links","link","i","length","Link","nodeA","includes","nodeB","push","traverseGraph","visited","neighbour","a","b","lineAngleAdjust","parallelPart","perpendicularPart","getAnchorPoint","abs","SNAP_TO_PADDING","getEndPointsAndCircle","midX","midY","start","end","anchor","circle","circleFromThreePoints","isReversed","reverseScale","rRatio","radius","startAngle","atan2","endAngle","startX","cos","startY","sin","endX","endY","linkInfo","textX","textY","textAngle","hasCircle","circleX","circleY","circleRadius","moveTo","lineTo","arrowIfReqd","distance","HIT_TARGET_PADDING","angle","temp","percent","SelfLink","node","mouse","anchorAngle","mouseOffsetAngle","snap","round","StartLink","deltaX","deltaY","getEndPoints","endPoints","TemporaryLink","from","to","HelpBox","topX","topY","BUTTON_WIDTH","BUTTON_HEIGHT","TEXT_OFFSET_X","TEXT_OFFSET_Y","LINE_HEIGHT","HELP_INDENT","isSelected","mouseIsOver","lines","helpText","fillStyle","fillRect","lineWidth","strokeStyle","strokeRect","font","textAlign","fillText","split","text","insertChar","char","slice","deleteChar","caretLeft","caretRight","angleOrNull","parentObject","graph","getCanvas","getContext","width","fontSize","beforeCaretText","convertLatexShortcuts","afterCaretText","measureText","cornerPointX","textOffset","cornerPointY","slide","pow","advancedFillText","selectedObject","caretVisible","hasFocus","document"],"mappings":"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","sourcesContent":["/******************************************************************************\n *\n * A module for use by ui_graph, defining classes Node, Link, SelfLink,\n * StartLink and TemporaryLink\n *\n ******************************************************************************/\n// This code is a modified version of Finite State Machine Designer\n// (http://madebyevan.com/fsm/)\n/*\n Finite State Machine Designer (http://madebyevan.com/fsm/)\n License: MIT License (see below)\n Copyright (c) 2010 Evan Wallace\n Permission is hereby granted, free of charge, to any person\n obtaining a copy of this software and associated documentation\n files (the \"Software\"), to deal in the Software without\n restriction, including without limitation the rights to use,\n copy, modify, merge, publish, distribute, sublicense, and/or sell\n copies of the Software, and to permit persons to whom the\n Software is furnished to do so, subject to the following\n conditions:\n The above copyright notice and this permission notice shall be\n included in all copies or substantial portions of the Software.\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND,\n EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES\n OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND\n NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT\n HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,\n WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR\n OTHER DEALINGS IN THE SOFTWARE.\n*/\n// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more util.details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n\ndefine(['qtype_coderunner/graphutil'], function(util) {\n\n    /***********************************************************************\n     *\n     * Define a class Node that represents a node in a graph\n     *\n     ***********************************************************************/\n\n    function Node(parent, x, y) {\n        this.parent = parent;  // The ui_graph instance.\n        this.x = x;\n        this.y = y;\n        this.mouseOffsetX = 0;\n        this.mouseOffsetY = 0;\n        this.isAcceptState = false;\n        this.textBox = new TextBox('');\n        this.caretPosition = 0;\n    }\n\n    // At the start of a drag, record our position relative to the mouse.\n    Node.prototype.setMouseStart = function(mouseX, mouseY) {\n        this.mouseOffsetX = this.x - mouseX;\n        this.mouseOffsetY = this.y - mouseY;\n    };\n\n    Node.prototype.setAnchorPoint = function(x, y) {\n        this.x = x + this.mouseOffsetX;\n        this.y = y + this.mouseOffsetY;\n    };\n\n    // Given a new mouse position during a drag, move to the appropriate\n    // new position.\n    Node.prototype.trackMouse = function(mouseX, mouseY) {\n        this.x = this.mouseOffsetX + mouseX;\n        this.y = this.mouseOffsetY + mouseY;\n    };\n\n    Node.prototype.draw = function(c) {\n        // Draw the circle.\n        c.beginPath();\n        c.arc(this.x, this.y, this.parent.nodeRadius(), 0, 2 * Math.PI, false);\n        c.stroke();\n\n        // Draw the text.\n        this.textBox.draw(this.x, this.y, null, this);\n\n        // Draw a double circle for an accept state.\n        if(this.isAcceptState) {\n            c.beginPath();\n            c.arc(this.x, this.y, this.parent.nodeRadius() - 6, 0, 2 * Math.PI, false);\n            c.stroke();\n        }\n    };\n\n    Node.prototype.closestPointOnCircle = function(x, y) {\n        var dx = x - this.x;\n        var dy = y - this.y;\n        var scale = Math.sqrt(dx * dx + dy * dy);\n        return {\n            'x': this.x + dx * this.parent.nodeRadius() / scale,\n            'y': this.y + dy * this.parent.nodeRadius() / scale,\n        };\n    };\n\n    Node.prototype.containsPoint = function(x, y) {\n        return (x - this.x) * (x - this.x) + (y - this.y) * (y - this.y) < this.parent.nodeRadius() * this.parent.nodeRadius();\n    };\n\n    // Method of a Node that, given a list of all links in a graph, returns\n    // a list of any nodes that contain a link to this node (excluding StartLinks\n    // and SelfLinks).\n    Node.prototype.neighbours = function(links) {\n        var neighbours = [], link;\n        for (var i = 0; i < links.length; i++) {\n            link = links[i];\n            if (link instanceof Link) { // Exclude SelfLinks and StartLinks.\n                if (link.nodeA === this && !neighbours.includes(link.nodeB)) {\n                    neighbours.push(link.nodeB);\n                } else if (link.nodeB === this && !neighbours.includes(link.nodeA)) {\n                    neighbours.push(link.nodeA);\n                }\n            }\n        }\n        return neighbours;\n    };\n\n    // Method of Node that traverses a graph defined by a given set of links\n    // starting at 'this' node and updating the visited list for each new\n    // node. Returns the updated visited list, which (for the root call)\n    // is a list of all nodes connected to the given start node.\n    Node.prototype.traverseGraph = function(links, visited) {\n        var neighbours,\n            neighbour;\n        if (!visited.includes(this)) {\n            visited.push(this);\n            neighbours = this.neighbours(links);\n            for (var i = 0; i < neighbours.length; i++) {\n                neighbour = neighbours[i];\n                if (!visited.includes(neighbour)) {\n                    neighbour.traverseGraph(links, visited);\n                }\n            }\n        }\n        return visited;\n    };\n\n    /***********************************************************************\n     *\n     * Define a class Link that represents a connection between two nodes.\n     *\n     ***********************************************************************/\n    function Link(parent, a, b) {\n        this.parent = parent;  // The parent ui_digraph instance.\n        this.nodeA = a;\n        this.nodeB = b;\n        this.textBox = new TextBox('');\n        this.lineAngleAdjust = 0; // Value to add to textAngle when link is straight line.\n        this.caretPosition = 0;\n\n        // Make anchor point relative to the locations of nodeA and nodeB.\n        this.parallelPart = 0.5;    // Percentage from nodeA to nodeB.\n        this.perpendicularPart = 0; // Pixels from line between nodeA and nodeB.\n    }\n\n    Link.prototype.getAnchorPoint = function() {\n        var dx = this.nodeB.x - this.nodeA.x;\n        var dy = this.nodeB.y - this.nodeA.y;\n        var scale = Math.sqrt(dx * dx + dy * dy);\n        return {\n            'x': this.nodeA.x + dx * this.parallelPart - dy * this.perpendicularPart / scale,\n            'y': this.nodeA.y + dy * this.parallelPart + dx * this.perpendicularPart / scale\n        };\n    };\n\n    Link.prototype.setAnchorPoint = function(x, y) {\n        var dx = this.nodeB.x - this.nodeA.x;\n        var dy = this.nodeB.y - this.nodeA.y;\n        var scale = Math.sqrt(dx * dx + dy * dy);\n        this.parallelPart = (dx * (x - this.nodeA.x) + dy * (y - this.nodeA.y)) / (scale * scale);\n        this.perpendicularPart = (dx * (y - this.nodeA.y) - dy * (x - this.nodeA.x)) / scale;\n        // Snap to a straight line.\n        if(this.parallelPart > 0 && this.parallelPart < 1 && Math.abs(this.perpendicularPart) < this.parent.SNAP_TO_PADDING) {\n            this.lineAngleAdjust = (this.perpendicularPart < 0) * Math.PI;\n            this.perpendicularPart = 0;\n        }\n    };\n\n    Link.prototype.getEndPointsAndCircle = function() {\n        if(this.perpendicularPart === 0) {\n            var midX = (this.nodeA.x + this.nodeB.x) / 2;\n            var midY = (this.nodeA.y + this.nodeB.y) / 2;\n            var start = this.nodeA.closestPointOnCircle(midX, midY);\n            var end = this.nodeB.closestPointOnCircle(midX, midY);\n            return {\n                'hasCircle': false,\n                'startX': start.x,\n                'startY': start.y,\n                'endX': end.x,\n                'endY': end.y,\n            };\n        }\n        var anchor = this.getAnchorPoint();\n        var circle = util.circleFromThreePoints(this.nodeA.x, this.nodeA.y, this.nodeB.x, this.nodeB.y, anchor.x, anchor.y);\n        var isReversed = (this.perpendicularPart > 0);\n        var reverseScale = isReversed ? 1 : -1;\n        var rRatio = reverseScale * this.parent.nodeRadius() / circle.radius;\n        var startAngle = Math.atan2(this.nodeA.y - circle.y, this.nodeA.x - circle.x) - rRatio;\n        var endAngle = Math.atan2(this.nodeB.y - circle.y, this.nodeB.x - circle.x) + rRatio;\n        var startX = circle.x + circle.radius * Math.cos(startAngle);\n        var startY = circle.y + circle.radius * Math.sin(startAngle);\n        var endX = circle.x + circle.radius * Math.cos(endAngle);\n        var endY = circle.y + circle.radius * Math.sin(endAngle);\n        return {\n            'hasCircle': true,\n            'startX': startX,\n            'startY': startY,\n            'endX': endX,\n            'endY': endY,\n            'startAngle': startAngle,\n            'endAngle': endAngle,\n            'circleX': circle.x,\n            'circleY': circle.y,\n            'circleRadius': circle.radius,\n            'reverseScale': reverseScale,\n            'isReversed': isReversed,\n        };\n    };\n\n    Link.prototype.draw = function(c) {\n        var linkInfo = this.getEndPointsAndCircle(), textX, textY, textAngle;\n        // Draw arc.\n        c.beginPath();\n        if(linkInfo.hasCircle) {\n            c.arc(linkInfo.circleX,\n                  linkInfo.circleY,\n                  linkInfo.circleRadius,\n                  linkInfo.startAngle,\n                  linkInfo.endAngle,\n                  linkInfo.isReversed);\n        } else {\n            c.moveTo(linkInfo.startX, linkInfo.startY);\n            c.lineTo(linkInfo.endX, linkInfo.endY);\n        }\n        c.stroke();\n        // Draw the head of the arrow.\n        if(linkInfo.hasCircle) {\n            this.parent.arrowIfReqd(c,\n                      linkInfo.endX,\n                      linkInfo.endY,\n                      linkInfo.endAngle - linkInfo.reverseScale * (Math.PI / 2));\n        } else {\n            this.parent.arrowIfReqd(c,\n                      linkInfo.endX,\n                      linkInfo.endY,\n                      Math.atan2(linkInfo.endY - linkInfo.startY, linkInfo.endX - linkInfo.startX));\n        }\n        // Draw the text.\n        if(linkInfo.hasCircle) {\n            var startAngle = linkInfo.startAngle;\n            var endAngle = linkInfo.endAngle;\n            if(endAngle < startAngle) {\n                endAngle += Math.PI * 2;\n            }\n            textAngle = (startAngle + endAngle) / 2 + linkInfo.isReversed * Math.PI;\n            textX = linkInfo.circleX + linkInfo.circleRadius * Math.cos(textAngle);\n            textY = linkInfo.circleY + linkInfo.circleRadius * Math.sin(textAngle);\n            this.textBox.draw(textX, textY, textAngle, this);\n        } else {\n            textX = (linkInfo.startX + linkInfo.endX) / 2;\n            textY = (linkInfo.startY + linkInfo.endY) / 2;\n            textAngle = Math.atan2(linkInfo.endX - linkInfo.startX, linkInfo.startY - linkInfo.endY);\n            this.textBox.draw(textX, textY, textAngle + this.lineAngleAdjust, this);\n        }\n    };\n\n    Link.prototype.containsPoint = function(x, y) {\n        var linkInfo = this.getEndPointsAndCircle(), dx, dy, distance;\n        if(linkInfo.hasCircle) {\n            dx = x - linkInfo.circleX;\n            dy = y - linkInfo.circleY;\n            distance = Math.sqrt(dx * dx + dy * dy) - linkInfo.circleRadius;\n            if(Math.abs(distance) < this.parent.HIT_TARGET_PADDING) {\n                var angle = Math.atan2(dy, dx);\n                var startAngle = linkInfo.startAngle;\n                var endAngle = linkInfo.endAngle;\n                if(linkInfo.isReversed) {\n                    var temp = startAngle;\n                    startAngle = endAngle;\n                    endAngle = temp;\n                }\n                if(endAngle < startAngle) {\n                    endAngle += Math.PI * 2;\n                }\n                if(angle < startAngle) {\n                    angle += Math.PI * 2;\n                } else if(angle > endAngle) {\n                    angle -= Math.PI * 2;\n                }\n                return (angle > startAngle && angle < endAngle);\n            }\n        } else {\n            dx = linkInfo.endX - linkInfo.startX;\n            dy = linkInfo.endY - linkInfo.startY;\n            var length = Math.sqrt(dx * dx + dy * dy);\n            var percent = (dx * (x - linkInfo.startX) + dy * (y - linkInfo.startY)) / (length * length);\n            distance = (dx * (y - linkInfo.startY) - dy * (x - linkInfo.startX)) / length;\n            return (percent > 0 && percent < 1 && Math.abs(distance) < this.parent.HIT_TARGET_PADDING);\n        }\n        return false;\n    };\n\n    /***********************************************************************\n     *\n     * Define a class SelfLink that represents a connection from a node back\n     * to itself.\n     *\n     ***********************************************************************/\n\n    function SelfLink(parent, node, mouse) {\n        this.parent = parent;\n        this.node = node;\n        this.anchorAngle = 0;\n        this.mouseOffsetAngle = 0;\n        this.textBox = new TextBox('');\n\n        if(mouse) {\n            this.setAnchorPoint(mouse.x, mouse.y);\n        }\n    }\n\n    SelfLink.prototype.setMouseStart = function(x, y) {\n        this.mouseOffsetAngle = this.anchorAngle - Math.atan2(y - this.node.y, x - this.node.x);\n    };\n\n    SelfLink.prototype.setAnchorPoint = function(x, y) {\n        this.anchorAngle = Math.atan2(y - this.node.y, x - this.node.x) + this.mouseOffsetAngle;\n        // Snap to 90 degrees.\n        var snap = Math.round(this.anchorAngle / (Math.PI / 2)) * (Math.PI / 2);\n        if(Math.abs(this.anchorAngle - snap) < 0.1) {\n            this.anchorAngle = snap;\n        }\n        // Keep in the range -pi to pi so our containsPoint() function always works.\n        if(this.anchorAngle < -Math.PI) {\n            this.anchorAngle += 2 * Math.PI;\n        }\n        if(this.anchorAngle > Math.PI) {\n            this.anchorAngle -= 2 * Math.PI;\n        }\n    };\n\n    SelfLink.prototype.getEndPointsAndCircle = function() {\n        var circleX = this.node.x + 1.5 * this.parent.nodeRadius() * Math.cos(this.anchorAngle);\n        var circleY = this.node.y + 1.5 * this.parent.nodeRadius() * Math.sin(this.anchorAngle);\n        var circleRadius = 0.75 * this.parent.nodeRadius();\n        var startAngle = this.anchorAngle - Math.PI * 0.8;\n        var endAngle = this.anchorAngle + Math.PI * 0.8;\n        var startX = circleX + circleRadius * Math.cos(startAngle);\n        var startY = circleY + circleRadius * Math.sin(startAngle);\n        var endX = circleX + circleRadius * Math.cos(endAngle);\n        var endY = circleY + circleRadius * Math.sin(endAngle);\n        return {\n            'hasCircle': true,\n            'startX': startX,\n            'startY': startY,\n            'endX': endX,\n            'endY': endY,\n            'startAngle': startAngle,\n            'endAngle': endAngle,\n            'circleX': circleX,\n            'circleY': circleY,\n            'circleRadius': circleRadius\n        };\n    };\n\n    SelfLink.prototype.draw = function(c) {\n        var linkInfo = this.getEndPointsAndCircle();\n        // Draw arc.\n        c.beginPath();\n        c.arc(linkInfo.circleX, linkInfo.circleY, linkInfo.circleRadius, linkInfo.startAngle, linkInfo.endAngle, false);\n        c.stroke();\n        // Draw the text on the loop farthest from the node.\n        var textX = linkInfo.circleX + linkInfo.circleRadius * Math.cos(this.anchorAngle);\n        var textY = linkInfo.circleY + linkInfo.circleRadius * Math.sin(this.anchorAngle);\n        this.textBox.draw(textX, textY, this.anchorAngle, this);\n        // Draw the head of the arrow.\n        this.parent.arrowIfReqd(c, linkInfo.endX, linkInfo.endY, linkInfo.endAngle + Math.PI * 0.4);\n    };\n\n    SelfLink.prototype.containsPoint = function(x, y) {\n        var linkInfo = this.getEndPointsAndCircle();\n        var dx = x - linkInfo.circleX;\n        var dy = y - linkInfo.circleY;\n        var distance = Math.sqrt(dx * dx + dy * dy) - linkInfo.circleRadius;\n        return (Math.abs(distance) < this.parent.HIT_TARGET_PADDING);\n    };\n\n    /***********************************************************************\n     *\n     * Define a class StartLink that represents a start link in a finite\n     * state machine. Not useful in general digraphs.\n     *\n     ***********************************************************************/\n    function StartLink(parent, node, start) {\n        this.parent = parent;\n        this.node = node;\n        this.deltaX = 0;\n        this.deltaY = 0;\n\n        if(start) {\n            this.setAnchorPoint(start.x, start.y);\n        }\n    }\n\n    StartLink.prototype.setAnchorPoint = function(x, y) {\n        this.deltaX = x - this.node.x;\n        this.deltaY = y - this.node.y;\n\n        if(Math.abs(this.deltaX) < this.parent.SNAP_TO_PADDING) {\n            this.deltaX = 0;\n        }\n\n        if(Math.abs(this.deltaY) < this.parent.SNAP_TO_PADDING) {\n            this.deltaY = 0;\n        }\n    };\n\n    StartLink.prototype.getEndPoints = function() {\n        var startX = this.node.x + this.deltaX;\n        var startY = this.node.y + this.deltaY;\n        var end = this.node.closestPointOnCircle(startX, startY);\n        return {\n            'startX': startX,\n            'startY': startY,\n            'endX': end.x,\n            'endY': end.y,\n        };\n    };\n\n    StartLink.prototype.draw = function(c) {\n        var endPoints = this.getEndPoints();\n\n        // Draw the line.\n        c.beginPath();\n        c.moveTo(endPoints.startX, endPoints.startY);\n        c.lineTo(endPoints.endX, endPoints.endY);\n        c.stroke();\n\n        // Draw the head of the arrow.\n        this.parent.arrowIfReqd(c, endPoints.endX, endPoints.endY, Math.atan2(-this.deltaY, -this.deltaX));\n    };\n\n    StartLink.prototype.containsPoint = function(x, y) {\n        var endPoints = this.getEndPoints();\n        var dx = endPoints.endX - endPoints.startX;\n        var dy = endPoints.endY - endPoints.startY;\n        var length = Math.sqrt(dx * dx + dy * dy);\n        var percent = (dx * (x - endPoints.startX) + dy * (y - endPoints.startY)) / (length * length);\n        var distance = (dx * (y - endPoints.startY) - dy * (x - endPoints.startX)) / length;\n        return (percent > 0 && percent < 1 && Math.abs(distance) < this.parent.HIT_TARGET_PADDING);\n    };\n\n    /***********************************************************************\n     *\n     * Define a class TemporaryLink that represents a link that's in the\n     * process of being created.\n     *\n     ***********************************************************************/\n\n    function TemporaryLink(parent, from, to) {\n        this.parent = parent;\n        this.from = from;\n        this.to = to;\n    }\n\n    TemporaryLink.prototype.draw = function(c) {\n        // Draw the line.\n        c.beginPath();\n        c.moveTo(this.to.x, this.to.y);\n        c.lineTo(this.from.x, this.from.y);\n        c.stroke();\n\n        // Draw the head of the arrow.\n        this.parent.arrowIfReqd(c, this.to.x, this.to.y, Math.atan2(this.to.y - this.from.y, this.to.x - this.from.x));\n    };\n\n    /***********************************************************************\n     *\n     * Define a class HelpBox for the help box and its pseudo-menu buttonb.\n     *\n     ***********************************************************************/\n\n    function HelpBox(parent, topX, topY) {\n        this.BUTTON_WIDTH = 50;\n        this.BUTTON_HEIGHT = 25;\n        this.TEXT_OFFSET_X = 25;\n        this.TEXT_OFFSET_Y = 17;\n        this.LINE_HEIGHT = 18;\n        this.HELP_INDENT = 5;\n        this.topX = topX;\n        this.topY = topY;\n        this.parent = parent;\n    }\n\n    HelpBox.prototype.containsPoint = function(x, y) {\n        return x >= this.topX && y >= this.topY &&\n                x <= this.topX + this.BUTTON_WIDTH &&\n                y <= this.topY + this.BUTTON_HEIGHT;\n    };\n\n    HelpBox.prototype.draw = function(c, isSelected, mouseIsOver) {\n        var lines, i, y, helpText;\n\n        if (mouseIsOver) {\n            c.fillStyle = '#FFFFFF';\n        } else {\n            c.fillStyle = '#F0F0F0';\n        }\n        c.fillRect(this.topX, this.topY,\n            this.topX + this.BUTTON_WIDTH, this.topY + this.BUTTON_HEIGHT);\n        c.lineWidth = 0.5;\n        c.strokeStyle = '#000000';\n        c.strokeRect(this.topX, this.topY,\n            this.topX + this.BUTTON_WIDTH, this.topY + this.BUTTON_HEIGHT);\n\n        c.font = '12pt Arial';\n        c.fillStyle = '#000000';\n        c.textAlign = \"center\";\n        c.fillText('Help', this.topX + this.TEXT_OFFSET_X, this.topY + this.TEXT_OFFSET_Y);\n        c.textAlign = \"left\";\n\n        if (isSelected) {\n            helpText = this.parent.helpText;\n            c.font = '12pt Arial';\n            lines = helpText.split('\\n');\n            y = this.topY + this.BUTTON_HEIGHT;\n            for (i = 0; i < lines.length; i += 1) {\n                y += this.LINE_HEIGHT;\n                c.fillText(lines[i], this.topX + this.HELP_INDENT, y);\n            }\n        }\n    };\n\n    /***********************************************************************\n     *\n     * Define a class TextBox for a possibly editable text box that might \n     * be contained in another element\n     *\n     ***********************************************************************/\n     \n    function TextBox(text) {\n        this.text = text;\n        this.caretPosition = text.length;\n    }\n    \n    \n    // Inserts a given character into the TextBox at its current caretPosition\n    TextBox.prototype.insertChar = function(char) {\n        this.text = this.text.slice(0, this.caretPosition) + char + this.text.slice(this.caretPosition);\n        this.caretPosition ++;\n    }\n\n    // Deletes the character in the TextBox that is located behind the current caretPosition \n    TextBox.prototype.deleteChar = function() {\n        if (this.caretPosition > 0){\n            this.text = this.text.slice(0, this.caretPosition - 1) + this.text.slice(this.caretPosition);\n            this.caretPosition --;\n        }\n    }\n\n    // Moves the TextBox's caret left one character if possible\n    TextBox.prototype.caretLeft = function() {\n        if (this.caretPosition > 0) {\n            this.caretPosition --;\n        }\n    }\n\n    // Moves the TextBox's caret right one character if possible\n    TextBox.prototype.caretRight = function() {\n        if (this.caretPosition < this.text.length) {\n            this.caretPosition ++;\n        }\n    }\n\n\n    TextBox.prototype.draw = function(x, y, angleOrNull, parentObject) {\n        var graph = parentObject.parent,\n            c = graph.getCanvas().getContext('2d'),\n            width,\n            dy;\n\n        c.font = graph.fontSize() + 'px Arial';\n        beforeCaretText = util.convertLatexShortcuts(this.text.slice(0, this.caretPosition));\n        afterCaretText = util.convertLatexShortcuts(this.text.slice(this.caretPosition));\n        width = c.measureText(beforeCaretText + afterCaretText).width;\n\n        // Center the text.\n        x -= width / 2;\n\n        // Position the text intelligently if given an angle.\n        if(angleOrNull !== null) {\n            var cos = Math.cos(angleOrNull);\n            var sin = Math.sin(angleOrNull);\n            var cornerPointX = (width / 2 + graph.textOffset()) * (cos > 0 ? 1 : -1);\n            var cornerPointY = (10 + graph.textOffset()) * (sin > 0 ? 1 : -1);\n            var slide = sin * Math.pow(Math.abs(sin), 40) * cornerPointX - cos * Math.pow(Math.abs(cos), 10) * cornerPointY;\n            x += cornerPointX - sin * slide;\n            y += cornerPointY + cos * slide;\n        }\n\n        // Draw text and caret (round the coordinates so the caret falls on a pixel).\n        if('advancedFillText' in c) {\n            c.advancedFillText(this.text, this.text, x + width / 2, y, angleOrNull);\n        } else {\n            x = Math.round(x);\n            y = Math.round(y);\n            dy = Math.round(graph.fontSize() / 3); // Don't understand this.\n\n            c.fillText(beforeCaretText, x, y + dy);\n\n            x += c.measureText(beforeCaretText).width;\n            c.fillText(afterCaretText, x, y + dy);\n\n            // Draw caret\n            if(parentObject == graph.selectedObject && graph.caretVisible && graph.hasFocus() && document.hasFocus()) {\n                dy = Math.round(graph.fontSize() / 2);\n                c.beginPath();\n                c.moveTo(x, y - dy);\n                c.lineTo(x, y + dy);\n                c.stroke();\n            }\n        }\n    };\n\n\n    return {\n        Node: Node,\n        Link: Link,\n        SelfLink: SelfLink,\n        TemporaryLink: TemporaryLink,\n        StartLink: StartLink,\n        HelpBox: HelpBox,\n        TextBox: TextBox\n    };\n});\n"],"file":"graphelements.min.js"}