define(["jquery"],function(a){function b(b,c,d,e){this.textArea=a(document.getElementById(b)),this.readOnly=this.textArea.prop("readonly"),this.templateParams=e,this.tableDiv=null,this.fail=!1,e.table_num_columns&&e.table_num_rows&&e.table_column_headers?this.reload():(this.fail=!0,this.failString="table_ui_missingparams")}return b.prototype.getElement=function(){return this.tableDiv},b.prototype.failed=function(){return this.fail},b.prototype.failMessage=function(){return this.failString},b.prototype.sync=function(){var b=[],c=!0,d=a(this.tableDiv).find("table tbody tr");d.each(function(){var d=[];a(this).find("textarea").each(function(){var b=a(this).val();d.push(b),b&&(c=!1)}),b.push(d)}),c?this.textArea.val(""):this.textArea.val(JSON.stringify(b))},b.prototype.reload=function(){var b=a(this.textArea).val(),c=[],d="<div style='height:fit-content' class='qtype-coderunner-table-outer-div'>\n<table class='table table-bordered'>\n",e=Math.trunc(100/this.templateParams.table_num_columns),f="<th style='width:"+e.toString()+"%'>";if(b)try{c=JSON.parse(b)}catch(g){return this.fail=!0,void(this.failString="table_ui_invalidjson")}try{d+="<thead>\n<tr>";for(var h=0;h<this.templateParams.table_num_columns;h++)d+=f+this.templateParams.table_column_headers[h]+"</th>";d+="</tr>\n</thead>\n",d+="<tbody>\n";for(var i=Math.max(this.templateParams.table_num_rows,c.length),j=0;j<i;j++){for(d+="<tr>",h=0;h<this.templateParams.table_num_columns;h++)d+="<td style='padding:2px;margin:0'>",d+='<textarea rows="2" style="width:97%;resize:vertical;font-family: monospace">',j<c.length&&(d+=c[j][h]),d+="</textarea></td>";d+="</tr>"}d+="</tbody>\n</table>\n</div>",this.tableDiv=a(d),this.templateParams.table_dynamic_rows&&this.addButtons()}catch(g){this.fail=!0,this.failString="table_ui_invalidserialisation"}},b.prototype.addButtons=function(){var b='<button type="button"style="float:right;margin-right:6px" disabled>Delete row</button>',c=a(b),d=this;this.tableDiv.append(c),c.click(function(){var b=d.tableDiv.find("table tbody tr").length,c=d.tableDiv.find("tr:last");b>d.templateParams.table_num_rows&&c.remove(),c=d.tableDiv.find("tr:last"),b==d.templateParams.table_num_rows+1&&a(this).prop("disabled",!0)});var e='<button type="button"style="float:right;margin-right:6px">Add row</button>',f=a(e);d.tableDiv.append(f),f.click(function(){var b,c;b=d.tableDiv.find("table tbody tr:last"),c=b.clone(),c.find("textarea").each(function(){a(this).val("")}),b.after(c),a(this).prev().prop("disabled",!1)})},b.prototype.resize=function(){},b.prototype.hasFocus=function(){var b=!1;return a(this.tableDiv).find("textarea").each(function(){this===document.activeElement&&(b=!0)}),b},b.prototype.destroy=function(){this.sync(),a(this.tableDiv).remove(),this.tableDiv=null},{Constructor:b}});