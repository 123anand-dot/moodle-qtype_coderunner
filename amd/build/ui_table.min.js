define(["jquery"],function(a){function b(b,c,d,e){this.textArea=a(document.getElementById(b)),this.readOnly=this.textArea.prop("readonly"),this.templateParams=e,this.tableDiv=null,this.fail=!1,e.table_num_columns&&e.table_num_rows&&e.table_column_headers?this.reload():(alert("Error in question: template parameters table_num_columns, table_num_rows and table_column_headers are all required"),this.fail=!0)}return b.prototype.getElement=function(){return this.tableDiv},b.prototype.failed=function(){return this.fail},b.prototype.sync=function(){var b=[],c=!0,d=a(this.tableDiv).find("table tbody tr");d.each(function(d){d=[],a(d).find("td").each(function(b){var e=a(b).val();d.push(e),e&&(c=!1)}),b.push(d)}),c?this.textArea.val(""):this.textArea.val(JSON.stringify(b))},b.prototype.join=function(a){for(var b="",c=0;c<a.length;c++)b+=a[c]+"\n";return b},b.prototype.reload=function(){var b=a(this.textArea).val(),c=[],d=["<div style='height:fit-content' class='qtype-coderunner-table-outer-div'>","<table style='table table-bordered'>","<thead>"],e="<tr>";if(b)try{c=JSON.parse(b)}catch(f){return c=[],void(this.fail=!0)}for(var g=0;g<this.templateParams.table_num_columns;g++)e+="<th>"+this.templateParams.table_column_headers[g]+"</th>";d.push(e+"</tr>"),d.push("</thead>"),d.push("<tbody>");for(var h=Math.max(this.templateParams.table_num_rows,c.length),i=0;i<h;i++){var j="<tr>";for(g=0;g<this.templateParams.table_num_columns;g++)j+="<td>",i<c.length&&(j+=c[i][g]),j+="</td>";d.push(j+"</tr>")}d.push("</tbody>"),d.push("</table>"),d.push("</div>"),this.tableDiv=a(this.join(d))},b.prototype.resize=function(){},b.prototype.hasFocus=function(){var a=!1;return this.getFields().each(function(){this===document.activeElement&&(a=!0)}),a},b.prototype.destroy=function(){this.sync(),a(this.tableDiv).remove(),this.tableDiv=null},{Constructor:b}});