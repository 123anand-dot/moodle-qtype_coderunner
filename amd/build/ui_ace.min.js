define ("qtype_coderunner/ui_ace",["jquery","qtype_coderunner/ace"],function(a,b){function c(c,d,e,f){var g=a(document.getElementById(c)),h=g[0]===document.activeElement,i=f.lang,j;try{alert("Got here");b.require("../../ace/ext/language_tools");this.modelist=window.ace.require("ace/ext/modelist");this.textarea=g;this.enabled=!1;this.contents_changed=!1;this.capturingTab=!1;this.clickInProgress=!1;this.editNode=a("<div></div>");this.editNode.css({resize:"none",height:e,width:"100%"});this.editor=window.ace.edit(this.editNode.get(0));if(g.prop("readonly")){this.editor.setReadOnly(!0)}this.editor.setOptions({enableBasicAutocompletion:!0,newLineMode:"unix"});this.editor.$blockScrolling=1/0;j=this.editor.getSession();j.setValue(this.textarea.val());this.setLanguage(i);this.setEventHandlers(g);this.captureTab();a(".ace_gutter").addClass("moodle-has-zindex");g.hide();if(h){this.editor.focus();this.editor.navigateFileEnd()}this.aceLabel=a(".answerprompt");this.aceLabel.attr("for","ace_"+c);this.aceTextarea=a(".ace_text-input");this.aceTextarea.attr("id","ace_"+c);this.fail=!1}catch(a){this.fail=!0}}c.prototype.failed=function(){return this.fail};c.prototype.failMessage=function(){return"ace_ui_notready"};c.prototype.sync=function(){};c.prototype.setLanguage=function(a){var b=this.editor.getSession(),c=this.findMode(a);if(c){b.setMode(c.mode)}};c.prototype.getElement=function(){return this.editNode};c.prototype.captureTab=function(){this.capturingTab=!0;this.editor.commands.bindKeys({Tab:"indent","Shift-Tab":"outdent"})};c.prototype.releaseTab=function(){this.capturingTab=!1;this.editor.commands.bindKeys({Tab:null,"Shift-Tab":null})};c.prototype.setEventHandlers=function(){var a=this;this.editor.getSession().on("change",function(){a.textarea.val(a.editor.getSession().getValue());a.contents_changed=!0});this.editor.on("blur",function(){if(a.contents_changed){a.textarea.trigger("change")}});this.editor.on("mousedown",function(){a.clickInProgress=!0});this.editor.on("focus",function(){if(a.clickInProgress){a.captureTab()}else{a.releaseTab()}});this.editor.on("click",function(){a.clickInProgress=!1});this.editor.container.addEventListener("keydown",function(b){if(b.which===void 0||0!==b.which){if(b.keyCode===77&&b.ctrlKey&&!b.altKey){if(a.capturingTab){a.releaseTab()}else{a.captureTab()}b.preventDefault()}else if(b.keyCode===27){a.releaseTab()}else if(!(b.shiftKey||b.ctrlKey||b.altKey||b.keyCode==9)){a.captureTab()}}},!0)};c.prototype.destroy=function(){var b;if(!this.fail){b=this.editor.isFocused();this.textarea.val(this.editor.getSession().getValue());this.editor.destroy();a(this.editNode).remove();if(b){this.textarea.focus();this.textarea[0].selectionStart=this.textarea[0].value.length}}};c.prototype.hasFocus=function(){return this.editor.isFocused()};c.prototype.findMode=function(a){var b,c,d,e=[],f={octave:"matlab",nodejs:"javascript","c#":"cs"};if("string"!=typeof a){return}if(a.toLowerCase()in f){a=f[a.toLowerCase()]}e=[a,a.replace(/\d+$/,"")];for(var g=0;g<e.length;g++){b=e[g];c="input."+b;d=this.modelist.modesByName[b]||this.modelist.modesByName[b.toLowerCase()]||this.modelist.getModeForPath(c)||this.modelist.getModeForPath(c.toLowerCase());if(d&&"text"!==d.name){return d}}};c.prototype.resize=function(a,b){this.editNode.outerHeight(b);this.editNode.outerWidth(a);this.editor.resize()};return{Constructor:c}});
//# sourceMappingURL=ui_ace.min.js.map
