define(["jquery"],function(a){function b(b,c,d,e){var f=a(document.getElementById(c)),g=this;this.MIN_WIDTH=400,this.MIN_HEIGHT=100,this.GUTTER=14,this.taId=c,this.readOnly=f.prop("readonly"),this.uiname=b,this.lang=e,this.textArea=f,this.uiInstance=null,d?this.templateParams=window.JSON.parse(d):this.templateParams={},this.buildGui(),a(document).mousemove(function(){g.checkForResize()}),a(window).resize(function(){g.checkForResize()}),a(document.body).on("keydown",function(a){var b=77;a.keyCode===b&&a.ctrlKey&&a.altKey&&(null!==g.uiInstance?g.destroy():g.restart())})}function c(a,c,d,e){return new b(a,c,d,e)}return b.prototype.buildGui=function(){var b=this,c=parseInt(this.textArea.css("height")),d=c-this.GUTTER,e=parseInt(this.textArea.css("width"));this.wrapperNode=a("<div id='"+this.taId+"_wrapper' class='ui_wrapper'></div>"),this.wrapperNode.css({resize:"vertical",overflow:"hidden",height:c,width:"100%",border:"1px solid darkgrey"}),require(["qtype_coderunner/ui_"+this.uiname],function(a){var f;b.uiInstance=new a.Constructor(b.taId,e,d,b.templateParams,b.lang),b.textArea.after(b.wrapperNode),f=b.uiInstance.getMinSize(),b.wrapperNode.css({minWidth:f.minWidth,minHeight:f.minHeight+b.GUTTER}),b.hLast=c,b.wLast=e,b.wrapperNode.append(b.uiInstance.getElement())}),this.textArea.hide()},b.prototype.destroy=function(){null!==this.uiInstance&&(this.textArea.show(),this.uiInstance.hasFocus()&&(this.textArea.focus(),this.textArea[0].selectionStart=this.textArea[0].value.length),this.uiInstance.destroy(),this.uiInstance=null,this.wrapperNode.remove())},b.prototype.restart=function(){null===this.uiInstance&&this.buildGui()},b.prototype.checkForResize=function(){var a,b;this.uiInstance&&(a=this.wrapperNode.outerHeight(),b=this.wrapperNode.outerWidth(),a=Math.max(this.MIN_HEIGHT,a),b=Math.max(this.MIN_WIDTH,b),(a!==this.hLast||b!==this.wLast&&this.uiInstance)&&(this.uiInstance.resize(b,a-this.GUTTER),this.hLast=a,this.wLast=b))},{newUiWrapper:c}});