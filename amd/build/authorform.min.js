define(["jquery"],function(a){function b(){a().ready(c)}function c(){function b(b){var c=o.prop("value").toLowerCase(),d=a("#id_"+b).is(":visible")||a("#id_"+b+"_wrapper").is(":visible");m.prop("checked")&&d&&require(["qtype_coderunner/aceinterface"],function(a){a.initAce("id_"+b,c)})}function c(a){var c=a?"block":"none";q.css("display",c),r.css("display",c),a&&(b("pertesttemplate"),b("combinatortemplate"))}function e(b,e){var f,h,i;for(var j in d)f=d[j],h=e[j]?e[j]:f[2],f.length>3&&(i=f[3],h=i(h)),a(f[0]).prop(f[1],h);u.prop("value",b),p.prop("checked",!1),w.html(g(b,e.questiontext)),c(!1)}function f(a,b){var c;window.alert(h("prototype_load_failure")+b),c=h("prototype_error")+"\n",c+=b+"\n",c+="CourseId: "+v+", qtype: "+a,k.prop("value",c)}function g(a,b){var c='<p class="question-type-details-header">';return c+=h("coderunner_question_type"),c+=a+"</p>\n"+b}function h(a){return M.util.get_string(a,"qtype_coderunner")}function i(){var b=j.children("option:selected").text();""!==b&&"Undefined"!==b&&(j.children("option:first-child").prop("disabled","disabled"),a.getJSON(M.cfg.wwwroot+"/question/type/coderunner/ajax.php",{qtype:b,courseid:v,sesskey:M.cfg.sesskey},function(a){a.success?e(b,a):f(b,a.error)}).error(function(){window.alert(h("error_loading_prototype")),k.prop("value",h("ajax_error"))}))}var j=a("#id_coderunnertype"),k=a("#id_pertesttemplate"),l=a("#id_enablecombinator"),m=a("#id_useace"),n=a("#id_combinatortemplate"),o=a("#id_language"),p=a("#id_customise"),q=a("#id_customisationheader"),r=a("#id_advancedcustomisationheader"),s=p.prop("checked"),t=a("#id_prototypetype"),u=a("#id_typename"),v=a('input[name="courseid"]').prop("value"),w=a("#qtype-help"),x=!1;1==t.prop("value")&&(window.alert(h("proceed_at_own_risk")),t.prop("disabled",!0),j.prop("disabled",!0),p.prop("disabled",!0)),c(s),s?w.setHTML("<p>"+h("info_unavailable")+"</p>"):i(),p.on("change",function(){var a=p.prop("checked");a?c(!0):window.confirm(h("confirm_proceed"))?c(!1):p.prop("checked",!0)}),k.on("change",function(){var a=""!==n.prop("value").trim();a&&!x&&l.prop("checked")&&window.confirm(h("template_changed"))&&l.prop("checked",!1),x=!0}),j.on("change",function(){(!p.prop("checked")||window.confirm(h("question_type_changed")))&&i()}),m.on("change",function(){var a=m.prop("checked");a?(b("pertesttemplate"),b("combinatortemplate")):require(["qtype_coderunner/aceinterface"],function(a){a.stopUsingAce()})});var y=new MutationObserver(function(){b("combinatortemplate")});y.observe(r.get(0),{attributes:!0})}var d={pertesttemplate:["#id_pertesttemplate","value",""],combinatortemplate:["#id_combinatortemplate","value",""],cputimelimitsecs:["#id_cputimelimitsecs","value",""],memlimitmb:["#id_memlimitmb","value",""],sandbox:["#id_sandbox","value","DEFAULT"],sandboxparams:["#id_sandboxparams","value",""],enablecombinator:["#id_enablecombinator","checked",!0,function(a){return"1"==a}],testsplitterre:["#id_testsplitterre","value","",function(a){return a.replace("\n","\\n")}],language:["#id_language","value",""]};return{initEditForm:b}});