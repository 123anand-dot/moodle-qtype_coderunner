define(["jquery"],function(a){function b(){a().ready(c)}function c(){function b(b,c){var d,e,f="id_"+b,g=a("#"+f);c=c.toLowerCase(),"none"===c&&(c=""),g&&(d=g.data("current-ui"),d&&d!==c&&(require(["qtype_coderunner/ui_"+d],function(a){a.destroyInstance(f)}),g.data("current-ui","")),"ace"===c?(e=p.prop("value"),"template"!==b&&q.prop("value")&&(e=q.prop("value")),require(["qtype_coderunner/ui_ace"],function(a){a.init(f,e)})):c&&c!==d&&require(["qtype_coderunner/ui_"+c],function(a){a.init(f)}),g.data("current-ui",c))}function c(){var a=F.val();b("answer",a),b("answerpreload",a)}function e(a){var c=a?"block":"none";v.css("display",c),w.css("display",c),a&&o.prop("checked")&&b("template","ace")}function f(){var a=s.prop("checked");t.prop("disabled",!a),u.prop("disabled",!a)}function g(b,c){var g,h,j;for(var k in d)g=d[k],h=c[k]?c[k]:g[2],g.length>3&&(j=g[3],h=j(h)),a(g[0]).prop(g[1],h);A.prop("value",b),r.prop("checked",!1),C.html(i(b,c.questiontext)),e(!1),f()}function h(a,b){var c;window.alert(j("prototype_load_failure")+b),c=j("prototype_error")+"\n",c+=b+"\n",c+="CourseId: "+B+", qtype: "+a,n.prop("value",c)}function i(a,b){var c='<p class="question-type-details-header">';return c+=j("coderunner_question_type"),c+=a+"</p>\n"+b}function j(a){return M.util.get_string(a,"qtype_coderunner")}function k(){var b=m.children("option:selected").text();""!==b&&"Undefined"!==b&&(m.children("option:first-child").prop("disabled","disabled"),a.getJSON(M.cfg.wwwroot+"/question/type/coderunner/ajax.php",{qtype:b,courseid:B,sesskey:M.cfg.sesskey},function(a){a.success?(g(b,a),c()):h(b,a.error)}).fail(function(){window.alert(j("error_loading_prototype")),n.prop("value",j("ajax_error"))}))}function l(){"3"===D.val()?E.show():E.hide()}var m=a("#id_coderunnertype"),n=a("#id_template"),o=a("#id_useace"),p=a("#id_language"),q=a("#id_acelang"),r=a("#id_customise"),s=a("#id_iscombinatortemplate"),t=a("#id_testsplitterre"),u=a("#id_allowmultiplestdins"),v=a("#id_customisationheader"),w=a("#id_advancedcustomisationheader"),x=r.prop("checked"),y=a("#id_prototypetype"),z=a("#id_answerpreloadhdr"),A=a("#id_typename"),B=a('input[name="courseid"]').prop("value"),C=a("#qtype-help"),D=a("select#id_precheck"),E=a("div.testtype"),F=a("#id_uiplugin");1==y.prop("value")&&(window.alert(j("proceed_at_own_risk")),y.prop("disabled",!0),m.prop("disabled",!0),r.prop("disabled",!0)),c(),e(x),x?C.html("<p>"+j("info_unavailable")+"</p>"):k(),l(),r.on("change",function(){var a=r.prop("checked");a?e(!0):window.confirm(j("confirm_proceed"))?e(!1):r.prop("checked",!0)}),q.on("change",function(){"ace"===F.val()&&c()}),m.on("change",function(){r.prop("checked")&&!window.confirm(j("question_type_changed"))||k()}),o.on("change",function(){var a=o.prop("checked");a?b("template","ace"):b("template","")}),F.on("change",c),D.on("change",l);var G=new MutationObserver(function(){c()});G.observe(z.get(0),{attributes:!0}),a("button.replaceexpectedwithgot").click(function(){var b=a(this).prev('pre[id^="id_got_"]'),c=b.attr("id").replace("id_got_","");a("#id_expected_"+c).val(b.text()),a("#id_fail_expected_"+c).html(b.text()),a(".failrow_"+c).addClass("fixed"),a(this).prop("disabled",!0)})}var d={template:["#id_template","value",""],iscombinatortemplate:["#id_iscombinatortemplate","checked","",function(a){return"1"===a}],cputimelimitsecs:["#id_cputimelimitsecs","value",""],memlimitmb:["#id_memlimitmb","value",""],sandbox:["#id_sandbox","value","DEFAULT"],sandboxparams:["#id_sandboxparams","value",""],testsplitterre:["#id_testsplitterre","value","",function(a){return a.replace("\n","\\n")}],allowmultiplestdins:["#id_allowmultiplestdins","checked","",function(a){return"1"===a}],grader:["#id_grader","value","EqualityGrader"],resultcolumns:["#id_resultcolumns","value",""],language:["#id_language","value",""],acelang:["#id_acelang","value",""],uiplugin:["#id_uiplugin","value","ace"]};return{initEditForm:b}});