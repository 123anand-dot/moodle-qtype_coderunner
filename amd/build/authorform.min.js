define(["jquery"],function(a){function b(){a().ready(c)}function c(){function b(b){var c=p.prop("value").toLowerCase(),d=a("#id_"+b).is(":visible")||a("#id_"+b+"_wrapper").is(":visible");n.prop("checked")&&d&&require(["qtype_coderunner/aceinterface"],function(a){a.initAce("id_"+b,c)})}function c(a){var c=a?"block":"none";r.css("display",c),s.css("display",c),a&&(b("pertesttemplate"),b("combinatortemplate"))}function e(b,e){var f,h,i;for(var j in d)f=d[j],h=e[j]?e[j]:f[2],f.length>3&&(i=f[3],h=i(h)),a(f[0]).prop(f[1],h);v.prop("value",b),q.prop("checked",!1),x.html(g(b,e.questiontext)),c(!1)}function f(a,b){var c;window.alert(h("prototype_load_failure")+b),c=h("prototype_error")+"\n",c+=b+"\n",c+="CourseId: "+w+", qtype: "+a,l.prop("value",c)}function g(a,b){var c='<p class="question-type-details-header">';return c+=h("coderunner_question_type"),c+=a+"</p>\n"+b}function h(a){return M.util.get_string(a,"qtype_coderunner")}function i(){var b=k.children("option:selected").text();""!==b&&"Undefined"!==b&&(k.children("option:first-child").prop("disabled","disabled"),a.getJSON(M.cfg.wwwroot+"/question/type/coderunner/ajax.php",{qtype:b,courseid:w,sesskey:M.cfg.sesskey},function(a){a.success?e(b,a):f(b,a.error)}).error(function(){window.alert(h("error_loading_prototype")),l.prop("value",h("ajax_error"))}))}function j(){"3"===y.val()?z.show():z.hide()}var k=a("#id_coderunnertype"),l=a("#id_pertesttemplate"),m=a("#id_enablecombinator"),n=a("#id_useace"),o=a("#id_combinatortemplate"),p=a("#id_language"),q=a("#id_customise"),r=a("#id_customisationheader"),s=a("#id_advancedcustomisationheader"),t=q.prop("checked"),u=a("#id_prototypetype"),v=a("#id_typename"),w=a('input[name="courseid"]').prop("value"),x=a("#qtype-help"),y=a("select#id_precheck"),z=a("div[id^=fitem_id_testtype]"),A=!1;1==u.prop("value")&&(window.alert(h("proceed_at_own_risk")),u.prop("disabled",!0),k.prop("disabled",!0),q.prop("disabled",!0)),b("answer"),c(t),t?x.html("<p>"+h("info_unavailable")+"</p>"):i(),j(),q.on("change",function(){var a=q.prop("checked");a?c(!0):window.confirm(h("confirm_proceed"))?c(!1):q.prop("checked",!0)}),l.on("change",function(){var a=""!==o.prop("value").trim();a&&!A&&m.prop("checked")&&window.confirm(h("template_changed"))&&m.prop("checked",!1),A=!0}),k.on("change",function(){q.prop("checked")&&!window.confirm(h("question_type_changed"))||i()}),n.on("change",function(){var a=n.prop("checked");a?(b("pertesttemplate"),b("combinatortemplate")):require(["qtype_coderunner/aceinterface"],function(a){a.stopUsingAce()})}),y.on("change",j);var B=new MutationObserver(function(){b("combinatortemplate")});B.observe(s.get(0),{attributes:!0})}var d={pertesttemplate:["#id_pertesttemplate","value",""],combinatortemplate:["#id_combinatortemplate","value",""],cputimelimitsecs:["#id_cputimelimitsecs","value",""],memlimitmb:["#id_memlimitmb","value",""],sandbox:["#id_sandbox","value","DEFAULT"],sandboxparams:["#id_sandboxparams","value",""],enablecombinator:["#id_enablecombinator","checked",!0,function(a){return"1"==a}],testsplitterre:["#id_testsplitterre","value","",function(a){return a.replace("\n","\\n")}],language:["#id_language","value",""]};return{initEditForm:b}});