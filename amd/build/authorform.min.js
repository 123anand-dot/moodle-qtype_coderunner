define(["jquery","qtype_coderunner/userinterfacewrapper"],function(a,b){function c(){a().ready(d)}function d(){function c(c,d){var e,f,g=a(document.getElementById(c));d=d.toLowerCase(),"none"===d&&(d=""),g&&(e=g.data("current-ui"),e&&(e.destroy(),e=null),"ace"===d?(f=q.prop("value"),"id_template"!==c&&r.prop("value")&&(f=r.prop("value")),e=b.newUiWrapper(d,c,G,f)):""!==d&&(e=b.newUiWrapper(d,c,G)),g.data("current-ui",e))}function d(){var a=H.val();c("id_answer",a),c("id_answerpreload",a)}function f(a){var b=a?"block":"none";w.css("display",b),x.css("display",b),a&&p.prop("checked")&&c("id_template","ace")}function g(){var a=t.prop("checked");u.prop("disabled",!a),v.prop("disabled",!a)}function h(b,c){var d,h,i;for(var k in e)d=e[k],h=c[k]?c[k]:d[2],d.length>3&&(i=d[3],h=i(h)),a(d[0]).prop(d[1],h);B.prop("value",b),s.prop("checked",!1),D.html(j(b,c.questiontext)),f(!1),g()}function i(a,b){var c;window.alert(k("prototype_load_failure")+b),c=k("prototype_error")+"\n",c+=b+"\n",c+="CourseId: "+C+", qtype: "+a,o.prop("value",c)}function j(a,b){var c='<p class="question-type-details-header">';return c+=k("coderunner_question_type"),c+=a+"</p>\n"+b}function k(a){return M.util.get_string(a,"qtype_coderunner")}function l(){var b=n.children("option:selected").text();""!==b&&"Undefined"!==b&&(n.children("option:first-child").prop("disabled","disabled"),a.getJSON(M.cfg.wwwroot+"/question/type/coderunner/ajax.php",{qtype:b,courseid:C,sesskey:M.cfg.sesskey},function(a){a.success?(h(b,a),d()):i(b,a.error)}).fail(function(){window.alert(k("error_loading_prototype")),o.prop("value",k("ajax_error"))}))}function m(){"3"===E.val()?F.show():F.hide()}var n=a("#id_coderunnertype"),o=a("#id_template"),p=a("#id_useace"),q=a("#id_language"),r=a("#id_acelang"),s=a("#id_customise"),t=a("#id_iscombinatortemplate"),u=a("#id_testsplitterre"),v=a("#id_allowmultiplestdins"),w=a("#id_customisationheader"),x=a("#id_advancedcustomisationheader"),y=s.prop("checked"),z=a("#id_prototypetype"),A=a("#id_answerpreloadhdr"),B=a("#id_typename"),C=a('input[name="courseid"]').prop("value"),D=a("#qtype-help"),E=a("select#id_precheck"),F=a("div.testtype"),G=a("#id_templateparams").val(),H=a("#id_uiplugin");1==z.prop("value")&&(window.alert(k("proceed_at_own_risk")),z.prop("disabled",!0),n.prop("disabled",!0),s.prop("disabled",!0)),d(),f(y),y?D.html("<p>"+k("info_unavailable")+"</p>"):l(),m(),s.on("change",function(){var a=s.prop("checked");a?f(!0):window.confirm(k("confirm_proceed"))?f(!1):s.prop("checked",!0)}),r.on("change",function(){"ace"===H.val()&&d()}),n.on("change",function(){s.prop("checked")&&!window.confirm(k("question_type_changed"))||l()}),p.on("change",function(){var a=p.prop("checked");a?c("template","ace"):c("template","")}),H.on("change",d),E.on("change",m);var I=new MutationObserver(function(){d()});I.observe(A.get(0),{attributes:!0}),a("button.replaceexpectedwithgot").click(function(){var b=a(this).prev('pre[id^="id_got_"]'),c=b.attr("id").replace("id_got_","");a("#id_expected_"+c).val(b.text()),a("#id_fail_expected_"+c).html(b.text()),a(".failrow_"+c).addClass("fixed"),a(this).prop("disabled",!0)})}var e={template:["#id_template","value",""],iscombinatortemplate:["#id_iscombinatortemplate","checked","",function(a){return"1"===a}],cputimelimitsecs:["#id_cputimelimitsecs","value",""],memlimitmb:["#id_memlimitmb","value",""],sandbox:["#id_sandbox","value","DEFAULT"],sandboxparams:["#id_sandboxparams","value",""],testsplitterre:["#id_testsplitterre","value","",function(a){return a.replace("\n","\\n")}],allowmultiplestdins:["#id_allowmultiplestdins","checked","",function(a){return"1"===a}],grader:["#id_grader","value","EqualityGrader"],resultcolumns:["#id_resultcolumns","value",""],language:["#id_language","value",""],acelang:["#id_acelang","value",""],uiplugin:["#id_uiplugin","value","ace"]};return{initEditForm:c}});