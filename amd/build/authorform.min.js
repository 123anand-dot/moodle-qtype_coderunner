define(["jquery","qtype_coderunner/userinterfacewrapper"],function(a,b){function c(b){a().ready(function(){d(b)})}function d(c){function d(d,e){var f,g,h,i=a(document.getElementById(d));e=e.toLowerCase(),"none"===e&&(e=""),f=i.data("current-ui-wrapper");try{g=window.JSON.parse(c)}catch(j){g={}}"ace"===e&&(h=u.prop("value"),"id_template"!==d&&v.prop("value")&&(h=m(v.prop("value"))),g.lang=h),f&&f.uiname===e&&f.params===g||(f?f.loadUi(e,g):f=new b.InterfaceWrapper(e,d,g))}function f(){var a=K.val();a&&(d("id_answer",a),d("id_answerpreload",a))}function g(a){var b=a?"block":"none";A.css("display",b),B.css("display",b),a&&t.prop("checked")&&d("id_template","ace")}function h(){var a=x.prop("checked");y.prop("disabled",!a),z.prop("disabled",!a)}function i(b,c){var d,f,i;for(var j in e)d=e[j],f=c[j]?c[j]:d[2],d.length>3&&(i=d[3],f=i(f)),a(d[0]).prop(d[1],f);F.prop("value",b),w.prop("checked",!1),H.html(k(b,c.questiontext)),g(!1),h()}function j(a,b){var c;window.alert(l("prototype_load_failure")+b),c=l("prototype_error")+"\n",c+=b+"\n",c+="CourseId: "+G+", qtype: "+a,s.prop("value",c)}function k(a,b){var c='<p class="question-type-details-header">';return c+=l("coderunner_question_type"),c+=a+"</p>\n"+b}function l(a){return M.util.get_string(a,"qtype_coderunner")}function m(a){var b,c;if(a.indexOf(",")<0)return a;for(b=a.split(","),c=0;c<b.length;c++)if(b[c].endsWith("*"))return b[c].substr(0,b[c].length-1);return b.length>0?b[0]:""}function n(){var b=r.children("option:selected").text();""!==b&&"Undefined"!==b&&(r.children("option:first-child").prop("disabled","disabled"),a.getJSON(M.cfg.wwwroot+"/question/type/coderunner/ajax.php",{qtype:b,courseid:G,sesskey:M.cfg.sesskey},function(a){a.success?(i(b,a),f()):j(b,a.error)}).fail(function(){window.alert(l("error_loading_prototype")),s.prop("value",l("ajax_error"))}))}function o(){"3"===I.val()?J.show():J.hide()}function p(){"ace"===K.val()&&f()}function q(){t.prop("checked")&&d("id_template","ace")}var r=a("#id_coderunnertype"),s=a("#id_template"),t=a("#id_useace"),u=a("#id_language"),v=a("#id_acelang"),w=a("#id_customise"),x=a("#id_iscombinatortemplate"),y=a("#id_testsplitterre"),z=a("#id_allowmultiplestdins"),A=a("#id_customisationheader"),B=a("#id_advancedcustomisationheader"),C=w.prop("checked"),D=a("#id_prototypetype"),E=a("#id_answerpreloadhdr"),F=a("#id_typename"),G=a('input[name="courseid"]').prop("value"),H=a("#qtype-help"),I=a("select#id_precheck"),J=a("div.testtype"),K=a("#id_uiplugin");1==D.prop("value")&&(window.alert(l("proceed_at_own_risk")),D.prop("disabled",!0),r.prop("disabled",!0),w.prop("disabled",!0)),g(C),C?(f(),H.html("<p>"+l("info_unavailable")+"</p>")):n(),o(),w.on("change",function(){var a=w.prop("checked");a?g(!0):window.confirm(l("confirm_proceed"))?g(!1):w.prop("checked",!0)}),v.on("change",p),u.on("change",function(){q(),p()}),r.on("change",function(){w.prop("checked")&&!window.confirm(l("question_type_changed"))||n()}),t.on("change",function(){var a=t.prop("checked");a?d("id_template","ace"):d("id_template","")}),K.on("change",f),I.on("change",o);var L=new MutationObserver(function(){f()});L.observe(E.get(0),{attributes:!0}),a("button.replaceexpectedwithgot").click(function(){var b=a(this).prev('pre[id^="id_got_"]'),c=b.attr("id").replace("id_got_","");a("#id_expected_"+c).val(b.text()),a("#id_fail_expected_"+c).html(b.text()),a(".failrow_"+c).addClass("fixed"),a(this).prop("disabled",!0)})}var e={template:["#id_template","value",""],iscombinatortemplate:["#id_iscombinatortemplate","checked","",function(a){return"1"===a}],cputimelimitsecs:["#id_cputimelimitsecs","value",""],memlimitmb:["#id_memlimitmb","value",""],sandbox:["#id_sandbox","value","DEFAULT"],sandboxparams:["#id_sandboxparams","value",""],testsplitterre:["#id_testsplitterre","value","",function(a){return a.replace("\n","\\n")}],allowmultiplestdins:["#id_allowmultiplestdins","checked","",function(a){return"1"===a}],grader:["#id_grader","value","EqualityGrader"],resultcolumns:["#id_resultcolumns","value",""],language:["#id_language","value",""],acelang:["#id_acelang","value",""],uiplugin:["#id_uiplugin","value","ace"]};return{initEditForm:c}});