define(["jquery","qtype_coderunner/userinterfacewrapper"],function(a,b){function c(){a().ready(d)}function d(){function c(c,d){var e,f,g,h=a(document.getElementById(c));d=d.toLowerCase(),"none"===d&&(d=""),e=h.data("current-ui-wrapper");try{f=window.JSON.parse(J)}catch(i){f={}}"ace"===d&&(g=t.prop("value"),"id_template"!==c&&u.prop("value")&&(g=l(u.prop("value"))),f.lang=g),e&&e.uiname===d&&e.params===f||(e?e.loadUi(d,f):e=new b.InterfaceWrapper(d,c,f))}function d(){var a=K.val();a&&(c("id_answer",a),c("id_answerpreload",a))}function f(a){var b=a?"block":"none";z.css("display",b),A.css("display",b),a&&s.prop("checked")&&c("id_template","ace")}function g(){var a=w.prop("checked");x.prop("disabled",!a),y.prop("disabled",!a)}function h(b,c){var d,h,i;for(var k in e)d=e[k],h=c[k]?c[k]:d[2],d.length>3&&(i=d[3],h=i(h)),a(d[0]).prop(d[1],h);E.prop("value",b),v.prop("checked",!1),G.html(j(b,c.questiontext)),f(!1),g()}function i(a,b){var c;window.alert(k("prototype_load_failure")+b),c=k("prototype_error")+"\n",c+=b+"\n",c+="CourseId: "+F+", qtype: "+a,r.prop("value",c)}function j(a,b){var c='<p class="question-type-details-header">';return c+=k("coderunner_question_type"),c+=a+"</p>\n"+b}function k(a){return M.util.get_string(a,"qtype_coderunner")}function l(a){var b,c;if(a.indexOf(",")<0)return a;for(b=a.split(","),c=0;c<b.length;c++)if(b[c].endsWith("*"))return b[c].substr(0,b[c].length-1);return b.length>0?b[0]:""}function m(){var b=q.children("option:selected").text();""!==b&&"Undefined"!==b&&(q.children("option:first-child").prop("disabled","disabled"),a.getJSON(M.cfg.wwwroot+"/question/type/coderunner/ajax.php",{qtype:b,courseid:F,sesskey:M.cfg.sesskey},function(a){a.success?(h(b,a),d()):i(b,a.error)}).fail(function(){window.alert(k("error_loading_prototype")),r.prop("value",k("ajax_error"))}))}function n(){"3"===H.val()?I.show():I.hide()}function o(){"ace"===K.val()&&d()}function p(){s.prop("checked")&&c("id_template","ace")}var q=a("#id_coderunnertype"),r=a("#id_template"),s=a("#id_useace"),t=a("#id_language"),u=a("#id_acelang"),v=a("#id_customise"),w=a("#id_iscombinatortemplate"),x=a("#id_testsplitterre"),y=a("#id_allowmultiplestdins"),z=a("#id_customisationheader"),A=a("#id_advancedcustomisationheader"),B=v.prop("checked"),C=a("#id_prototypetype"),D=a("#id_answerpreloadhdr"),E=a("#id_typename"),F=a('input[name="courseid"]').prop("value"),G=a("#qtype-help"),H=a("select#id_precheck"),I=a("div.testtype"),J=a("#id_templateparams").val(),K=a("#id_uiplugin");1==C.prop("value")&&(window.alert(k("proceed_at_own_risk")),C.prop("disabled",!0),q.prop("disabled",!0),v.prop("disabled",!0)),d(),f(B),B?G.html("<p>"+k("info_unavailable")+"</p>"):m(),n(),v.on("change",function(){var a=v.prop("checked");a?f(!0):window.confirm(k("confirm_proceed"))?f(!1):v.prop("checked",!0)}),u.on("change",o),t.on("change",function(){p(),o()}),q.on("change",function(){v.prop("checked")&&!window.confirm(k("question_type_changed"))||m()}),s.on("change",function(){var a=s.prop("checked");a?c("id_template","ace"):c("id_template","")}),K.on("change",d),H.on("change",n);var L=new MutationObserver(function(){d()});L.observe(D.get(0),{attributes:!0}),a("button.replaceexpectedwithgot").click(function(){var b=a(this).prev('pre[id^="id_got_"]'),c=b.attr("id").replace("id_got_","");a("#id_expected_"+c).val(b.text()),a("#id_fail_expected_"+c).html(b.text()),a(".failrow_"+c).addClass("fixed"),a(this).prop("disabled",!0)})}var e={template:["#id_template","value",""],iscombinatortemplate:["#id_iscombinatortemplate","checked","",function(a){return"1"===a}],cputimelimitsecs:["#id_cputimelimitsecs","value",""],memlimitmb:["#id_memlimitmb","value",""],sandbox:["#id_sandbox","value","DEFAULT"],sandboxparams:["#id_sandboxparams","value",""],testsplitterre:["#id_testsplitterre","value","",function(a){return a.replace("\n","\\n")}],allowmultiplestdins:["#id_allowmultiplestdins","checked","",function(a){return"1"===a}],grader:["#id_grader","value","EqualityGrader"],resultcolumns:["#id_resultcolumns","value",""],language:["#id_language","value",""],acelang:["#id_acelang","value",""],uiplugin:["#id_uiplugin","value","ace"]};return{initEditForm:c}});