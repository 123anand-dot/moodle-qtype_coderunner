define(["jquery","qtype_coderunner/userinterfacewrapper"],function(a,b){function c(){a().ready(d)}function d(){function c(c,d){var e,f,g,h=a(document.getElementById(c));d=d.toLowerCase(),"none"===d&&(d=""),e=h.data("current-ui-wrapper");try{f=window.JSON.parse(I)}catch(i){f={}}e&&e.uiname===d&&e.params==f||("ace"===d&&(g=s.prop("value"),"id_template"!==c&&t.prop("value")&&(g=l(t.prop("value"))),f.lang=g),e?e.loadUi(d,f):e=new b.InterfaceWrapper(d,c,f))}function d(){var a=J.val();c("id_answer",a),c("id_answerpreload",a)}function f(a){var b=a?"block":"none";y.css("display",b),z.css("display",b),a&&r.prop("checked")&&c("id_template","ace")}function g(){var a=v.prop("checked");w.prop("disabled",!a),x.prop("disabled",!a)}function h(b,c){var d,h,i;for(var k in e)d=e[k],h=c[k]?c[k]:d[2],d.length>3&&(i=d[3],h=i(h)),a(d[0]).prop(d[1],h);D.prop("value",b),u.prop("checked",!1),F.html(j(b,c.questiontext)),f(!1),g()}function i(a,b){var c;window.alert(k("prototype_load_failure")+b),c=k("prototype_error")+"\n",c+=b+"\n",c+="CourseId: "+E+", qtype: "+a,q.prop("value",c)}function j(a,b){var c='<p class="question-type-details-header">';return c+=k("coderunner_question_type"),c+=a+"</p>\n"+b}function k(a){return M.util.get_string(a,"qtype_coderunner")}function l(a){var b,c;if(a.indexOf(",")<0)return a;for(b=a.split(","),c=0;c<b.length;c++)if(b[c].endsWith("*"))return b[c].substr(0,b[c].length-1);return b.length>0?b[0]:""}function m(){var b=p.children("option:selected").text();""!==b&&"Undefined"!==b&&(p.children("option:first-child").prop("disabled","disabled"),a.getJSON(M.cfg.wwwroot+"/question/type/coderunner/ajax.php",{qtype:b,courseid:E,sesskey:M.cfg.sesskey},function(a){a.success?(h(b,a),d()):i(b,a.error)}).fail(function(){window.alert(k("error_loading_prototype")),q.prop("value",k("ajax_error"))}))}function n(){"3"===G.val()?H.show():H.hide()}function o(){"ace"===J.val()&&d()}var p=a("#id_coderunnertype"),q=a("#id_template"),r=a("#id_useace"),s=a("#id_language"),t=a("#id_acelang"),u=a("#id_customise"),v=a("#id_iscombinatortemplate"),w=a("#id_testsplitterre"),x=a("#id_allowmultiplestdins"),y=a("#id_customisationheader"),z=a("#id_advancedcustomisationheader"),A=u.prop("checked"),B=a("#id_prototypetype"),C=a("#id_answerpreloadhdr"),D=a("#id_typename"),E=a('input[name="courseid"]').prop("value"),F=a("#qtype-help"),G=a("select#id_precheck"),H=a("div.testtype"),I=a("#id_templateparams").val(),J=a("#id_uiplugin");1==B.prop("value")&&(window.alert(k("proceed_at_own_risk")),B.prop("disabled",!0),p.prop("disabled",!0),u.prop("disabled",!0)),d(),f(A),A?F.html("<p>"+k("info_unavailable")+"</p>"):m(),n(),u.on("change",function(){var a=u.prop("checked");a?f(!0):window.confirm(k("confirm_proceed"))?f(!1):u.prop("checked",!0)}),t.on("input",o),s.on("input",o),p.on("change",function(){u.prop("checked")&&!window.confirm(k("question_type_changed"))||m()}),r.on("change",function(){var a=r.prop("checked");a?c("id_template","ace"):c("id_template","")}),J.on("change",d),G.on("change",n);var K=new MutationObserver(function(){d()});K.observe(C.get(0),{attributes:!0}),a("button.replaceexpectedwithgot").click(function(){var b=a(this).prev('pre[id^="id_got_"]'),c=b.attr("id").replace("id_got_","");a("#id_expected_"+c).val(b.text()),a("#id_fail_expected_"+c).html(b.text()),a(".failrow_"+c).addClass("fixed"),a(this).prop("disabled",!0)})}var e={template:["#id_template","value",""],iscombinatortemplate:["#id_iscombinatortemplate","checked","",function(a){return"1"===a}],cputimelimitsecs:["#id_cputimelimitsecs","value",""],memlimitmb:["#id_memlimitmb","value",""],sandbox:["#id_sandbox","value","DEFAULT"],sandboxparams:["#id_sandboxparams","value",""],testsplitterre:["#id_testsplitterre","value","",function(a){return a.replace("\n","\\n")}],allowmultiplestdins:["#id_allowmultiplestdins","checked","",function(a){return"1"===a}],grader:["#id_grader","value","EqualityGrader"],resultcolumns:["#id_resultcolumns","value",""],language:["#id_language","value",""],acelang:["#id_acelang","value",""],uiplugin:["#id_uiplugin","value","ace"]};return{initEditForm:c}});