define(["jquery"],function(a){function b(a){m=!0,o.getPage(a).then(function(a){var c=a.getViewport({scale:q});g.height=c.height,g.width=c.width;var d={canvasContext:l,viewport:c},e=a.render(d);e.promise.then(function(){m=!1,null!==p&&(b(p),p=null)})}),j.html(a)}function c(a){m?p=a:b(a)}function d(){j<=1||(j--,c(j))}function e(){j>=o.numPages||(j++,c(j))}function f(c,f){g=a("#"+f+" canvas.qtype_coderunner_problemspec").get(0),h=a("#"+f+" button.qtype_coderunner_next"),i=a("#"+f+" button.qtype_coderunner_previous"),j=a("#"+f+" span.qtype_coderunner_pagenum"),k=a("#"+f+" span.qtype_coderunner_numpages"),l=g.getContext("2d"),h.click(e),i.click(d),a.getJSON(M.cfg.wwwroot+"/question/type/coderunner/problemspec.php",{questionid:c,sesskey:M.cfg.sesskey},function(a){var c,d;a.filecontentsb64?(window.alert("Yay"),c=atob(a.filecontentsb64),d=n.getDocument({data:c}),d.promise.then(function(a){o=a,k.html(a.numPages),b(1)})):window.alert("Bad response object")}).fail(function(){window.alert("Failed to load problem spec"),a("#"+f).html("<h2>Not tonight, Josephine</h2>")})}var g,h,i,j,k,l,m,n=window["pdfjs-dist/build/pdf"],o=null,j=1,m=!1,p=null,q=1;return n.GlobalWorkerOptions.workerSrc="//mozilla.github.io/pdf.js/build/pdf.worker.js",document.getElementById("prev").addEventListener("click",d),{loadQuestionText:f}});