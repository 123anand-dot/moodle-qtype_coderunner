define(["jquery"],function(a){function b(b,c){var d=a(document.getElementById(b)),e=parseInt(d.css("height")),f=parseInt(d.css("width"));this.HANDLE_SIZE=5,this.MIN_WIDTH=300,this.MIN_HEIGHT=100,this.editNode=a("<div></div>"),this.wrapperNode=a("<div id='"+b+"_wrapper'></div>"),this.editor=null,this.contents_changed=!1,this.hLast=e-this.HANDLE_SIZE,this.wLast=f-this.HANDLE_SIZE,this.textarea=d,this.wrapperNode.css({resize:"both",overflow:"hidden",height:e,width:f,minWidth:this.MIN_WIDTH,minHeight:this.MIN_HEIGHT}),this.editNode.css({resize:"none",height:e-this.HANDLE_SIZE,width:f-this.HANDLE_SIZE}),d.after(this.wrapperNode),this.wrapperNode.append(this.editNode),this.editor=window.ace.edit(this.editNode.get(0)),d.prop("readonly")&&this.editor.setReadOnly(!0),this.editor.setOptions({enableBasicAutocompletion:!0,newLineMode:"unix"}),this.editor.$blockScrolling=1/0,this.reload(c),this.setEventHandlers(d),d.hide()}b.prototype.setEventHandlers=function(){var a=this.wrapperNode.parent();this.editor.getSession().on("change",function(){this.textarea.val(this.editor.getSession().getValue()),this.contents_changed=!0}.bind(this)),this.editor.on("blur",function(){this.contents_changed&&this.textarea.trigger("change")}.bind(this)),a.get(0).onmousemove=function(){var a=this.wrapperNode.outerHeight(),b=this.wrapperNode.outerWidth();(a!=this.hLast||b!=this.wLast)&&(this.editNode.outerHeight(a-this.HANDLE_SIZE),this.editNode.outerWidth(b-this.HANDLE_SIZE),this.editor.resize(),this.hLast=a,this.wLast=b)}.bind(this)},b.prototype.close=function(){this.textarea.val(this.editor.getSession().getValue()),this.editor.destroy(),this.wrapperNode.remove(),this.textarea.show()},b.prototype.reload=function(a){var b=this.editor.getSession();b.setValue(this.textarea.val()),a&&b.setMode(a.mode)};var c=function(){this.mode=null,this.session=null,this.textarea=null,this.activeEditors={},this.modelist=window.ace.require("ace/ext/modelist"),window.ace.require("ace/ext/language_tools")};return c.prototype.findMode=function(a){var b,c,d,e=[];"octave"===a.toLowerCase()?a="matlab":"nodejs"===a.toLowerCase()&&(a="javascript"),e=[a,a.replace(/\d*$/,"")];for(var f=0;f<e.length;f++)if(b=e[f],c="input."+b,d=this.modelist.modesByName[b]||this.modelist.modesByName[b.toLowerCase()]||this.modelist.getModeForPath(c)||this.modelist.getModeForPath(c.toLowerCase()),d&&"text"!==d.name)return d},c.prototype.initAce=function(a,c){var d=this.findMode(c);this.activeEditors[a]?this.activeEditors[a].reload(d):this.activeEditors[a]=new b(a,d)},c.prototype.stopUsingAce=function(){for(var a in this.activeEditors)this.activeEditors[a].close();this.activeEditors={}},new c});